# ============================================
# Application Configuration
# ============================================
spring.application.name=oneGasGateway

# ============================================
# Server Configuration
# ============================================
server.port=8080
server.shutdown=graceful

# ============================================
# Spring Cloud Gateway Configuration
# ============================================
# Discovery Locator (disabilitato, usiamo configurazione manuale)
spring.cloud.gateway.server.webflux.discovery.locator.enabled=false

# ============================================
# CORS Configuration (Nuova sintassi)
# ============================================
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-origins=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-headers=*

# ============================================
# HTTP Client Configuration (Nuova sintassi)
# ============================================
spring.cloud.gateway.server.webflux.httpclient.connect-timeout=5000
spring.cloud.gateway.server.webflux.httpclient.response-timeout=10000
spring.cloud.gateway.server.webflux.httpclient.pool.max-connections=500
spring.cloud.gateway.server.webflux.httpclient.pool.max-idle-time=30000
spring.cloud.gateway.server.webflux.httpclient.pool.acquire-timeout=45000

# ============================================
# Load Balancer Configuration
# ============================================
spring.cloud.loadbalancer.enabled=true
spring.cloud.loadbalancer.cache.enabled=true
spring.cloud.loadbalancer.cache.ttl=30s
spring.cloud.loadbalancer.cache.capacity=128

## Configurazione Health Check
spring.cloud.loadbalancer.health-check.initial-delay=0
spring.cloud.loadbalancer.health-check.interval=25s
# Se un'istanza non risponde, viene rimossa per questo tempo
spring.cloud.loadbalancer.health-check.refetch-instances-interval=25s
#
# ============================================
# Meteor Instances Configuration
# ============================================
meteor.instances[0].instance-id=meteor-1
meteor.instances[0].host=localhost
meteor.instances[0].port=8081

meteor.instances[1].instance-id=meteor-2
meteor.instances[1].host=localhost
meteor.instances[1].port=8082

meteor.instances[2].instance-id=meteor-3
meteor.instances[2].host=localhost
meteor.instances[2].port=8083

meteor.instances[3].instance-id=meteor-4
meteor.instances[3].host=localhost
meteor.instances[3].port=8084

# ============================================
# Actuator Configuration
# ============================================
management.server.port=9090
management.endpoints.web.exposure.include=health,info,metrics,gateway,loggers
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=always
management.endpoint.gateway.access=UNRESTRICTED
management.simple.metrics.export.enabled=true

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.loadbalancer.cache=DEBUG
logging.level.com.aton.proj=DEBUG

logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

logging.file.name=logs/ongas-gateway.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30
logging.logback.rollingpolicy.total-size-cap=500MB