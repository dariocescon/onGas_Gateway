# ============================================
# ONGAS GATEWAY - CONFIGURAZIONE
# ============================================

# Nome dell'applicazione
spring.application.name=onGas_Gateway

# Porta del Gateway
server.port=8080

# ============================================
# SPRING CLOUD GATEWAY - ROUTES
# ============================================

# Route verso onGas_Commander con Load Balancing
spring.cloud.gateway.server.webflux.routes[0].id=meteor-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://ongas-meteor
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=StripPrefix=1
spring.cloud.gateway.server.webflux.routes[0].filters[1]=AddRequestHeader=X-Gateway-Source, onGas_Gateway

# Route di fallback (health check del gateway stesso)
#spring.cloud.gateway.server.webflux.routes[1].id=gateway-health
#spring.cloud.gateway.server.webflux.routes[1].uri=http://localhost:8080
#spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/health
#spring.cloud.gateway.server.webflux.routes[1].filters[0]=SetStatus=200

# ============================================
# LOAD BALANCER - CONFIGURAZIONE
# ============================================

# Abilita Load Balancer
spring.cloud.loadbalancer.enabled=true

# Lista delle istanze (configurate via Java - vedi LoadBalancerConfig.java)
ongas.meteor.instances[0].host=localhost
ongas.meteor.instances[0].port=8081
ongas.meteor.instances[1].host=localhost
ongas.meteor.instances[1].port=8082
ongas.meteor.instances[2].host=localhost
ongas.meteor.instances[2].port=8083

# ============================================
# GATEWAY - CONFIGURAZIONE GENERALE
# ============================================

# Timeout per le richieste (in millisecondi)
spring.cloud.gateway.server.webflux.httpclient.connect-timeout=5000
spring.cloud.gateway.server.webflux.httpclient.response-timeout=10s

# Pool di connessioni
spring.cloud.gateway.server.webflux.httpclient.pool.type=ELASTIC
spring.cloud.gateway.server.webflux.httpclient.pool.max-connections=500

# Abilita log delle route al startup
logging.level.org.springframework.cloud.gateway=DEBUG

# ============================================
# ACTUATOR - MONITORAGGIO
# ============================================

# Porta separata per actuator (opzionale)
management.server.port=9090

# Endpoint esposti
#management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoints.web.exposure.include=*

# Abilita endpoint Gateway
management.endpoint.gateway.access=unrestricted

# Mostra dettagli health
management.endpoint.health.show-details=always

# ============================================
# LOGGING
# ============================================

# File di configurazione Log4j2
logging.config=classpath:log4j2.properties

# ============================================
# CORS (opzionale)
# ============================================

# Abilita CORS per tutti gli endpoint
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-origins=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowed-headers=*